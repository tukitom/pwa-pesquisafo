<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Mapa Locais</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">
<link rel="stylesheet" href="styles.css">
<style>
#map {
  width: 100%;
  height: 80vh;
  border-radius: 8px;
  transition: transform 0.3s ease;
}
#controls {
  display: flex;
  justify-content: center;
  gap: 8px;
  margin-top: 10px;
}
#controls button {
  padding: 8px 12px;
}
</style>
</head>
<body>
<header>
  <nav>
    <button onclick="window.location.href='index.html'">ğŸ  InÃ­cio</button>
    <button onclick="window.location.href='app.html'">ğŸ“‚ CSV</button>
    <button onclick="window.location.href='calculadora.html'">ğŸ¨ Calculadora</button>
    <button onclick="window.location.href='mapa.html'">ğŸ—ºï¸ Mapa</button>
  </nav>
</header>

<div id="searchBox">
  <input id="searchInput" type="text" placeholder="Ex: PDO1001 ou JFO1001...">
  <select id="filterSelect">
    <option value="todos">Todos</option>
    <option value="pdo">SÃ³ PDOs</option>
    <option value="jfo">SÃ³ Juntas</option>
  </select>
  <button id="btnSearch">Procurar</button>
</div>

<div id="map"></div>

<div id="controls">
  <button id="rotateLeft">â†©ï¸ Rodar Esquerda</button>
  <button id="rotateRight">â†ªï¸ Rodar Direita</button>
  <button id="resetRotation">ğŸ”„ Reset</button>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
  const map = L.map('map').setView([39.454, -31.13], 13);
  
  // ğŸ›°ï¸ Vista de satÃ©lite
  L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
    maxZoom: 19,
    attribution: 'Tiles Â© Esri, Maxar, Earthstar Geographics'
  }).addTo(map);

  let todosOsMarkers = [];

  // Ãcones personalizados
  const blueIcon = new L.Icon({
    iconUrl: 'https://maps.google.com/mapfiles/ms/icons/blue-dot.png',
    iconSize: [32, 32]
  });
  const greenIcon = new L.Icon({
    iconUrl: 'https://maps.google.com/mapfiles/ms/icons/green-dot.png',
    iconSize: [32, 32]
  });

  // Carregar GeoJSON
  fetch("Locais etiquetados.json")
    .then(res => res.json())
    .then(data => {
      data.features.forEach(f => {
        const [lng, lat] = f.geometry.coordinates;
        const nome = f.properties.name;
        const address = f.properties.address || "";
        const tipo = nome.toLowerCase().includes("jfo") ? "jfo" : "pdo";
        const icon = tipo === "jfo" ? greenIcon : blueIcon;

        const marker = L.marker([lat, lng], { icon }).bindPopup(`<b>${nome}</b><br>${address}`);
        todosOsMarkers.push({ nome, tipo, marker });
        marker.addTo(map);
      });
    });

  // ğŸ” Pesquisa
  document.getElementById("btnSearch").addEventListener("click", () => {
    const termo = document.getElementById("searchInput").value.trim().toLowerCase();
    if (!termo) return alert("Escreve o nome do PDO ou JFO.");
    const encontrado = todosOsMarkers.find(m => m.nome.toLowerCase().includes(termo));
    if (!encontrado) return alert("Local nÃ£o encontrado!");
    map.flyTo(encontrado.marker.getLatLng(), 17);
    encontrado.marker.openPopup();
  });

  // ğŸ” Filtro
  document.getElementById("filterSelect").addEventListener("change", (e) => {
    const filtro = e.target.value;
    todosOsMarkers.forEach(({ tipo, marker }) => {
      if (filtro === "todos" || filtro === tipo) map.addLayer(marker);
      else map.removeLayer(marker);
    });
  });

  // ğŸ”„ Controlo de rotaÃ§Ã£o visual
  let currentRotation = 0;
  const mapEl = document.getElementById('map');

  document.getElementById('rotateLeft').onclick = () => {
    currentRotation -= 15;
    mapEl.style.transform = `rotate(${currentRotation}deg)`;
  };
  document.getElementById('rotateRight').onclick = () => {
    currentRotation += 15;
    mapEl.style.transform = `rotate(${currentRotation}deg)`;
  };
  document.getElementById('resetRotation').onclick = () => {
    currentRotation = 0;
    mapEl.style.transform = 'rotate(0deg)';
  };
</script>
</body>
</html>
